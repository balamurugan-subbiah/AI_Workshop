<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Device Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Light gray background */
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-primary {
            @apply bg-blue-500 text-white font-medium py-2 px-4 rounded-full shadow-lg hover:bg-blue-600 transition duration-300;
        }
    </style>
</head>
<body class="bg-gray-100 p-8 md:p-12">

    <div class="max-w-7xl mx-auto space-y-8">

        <!-- Header -->
        <header class="flex flex-col md:flex-row items-start md:items-center justify-between space-y-2 md:space-y-0 text-gray-700">
            <div class="flex-1">
                <h1 class="text-3xl font-bold text-gray-800">IoT Practice Team — Device Dashboard</h1>
                <p class="text-gray-500 text-sm mt-1">Self-contained HTML/JS app • Responsive • Demo data</p>
            </div>
            <div class="text-right text-sm">
                <p class="text-gray-500">Last update: <span id="last-update"></span></p>
            </div>
        </header>

        <!-- Main Dashboard Grid -->
        <main class="grid grid-cols-1 lg:grid-cols-4 gap-6">

            <!-- Left Column: Summary, Auto-refresh, Add devices -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Summary Card -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Summary</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-500">Devices</p>
                            <p id="summary-devices" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Online</p>
                            <p id="summary-online" class="text-2xl font-bold text-green-500">0</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Offline</p>
                            <p id="summary-offline" class="text-2xl font-bold text-red-500">0</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Alerts</p>
                            <p id="summary-alerts" class="text-2xl font-bold text-yellow-500">0</p>
                        </div>
                    </div>
                </div>

                <!-- Auto-refresh Card -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Auto-refresh</h2>
                    <div class="flex items-center space-x-4">
                        <p class="text-sm font-medium text-gray-700">Interval:</p>
                        <select id="refresh-interval" class="form-select block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="Off">Off</option>
                            <option value="1">1s</option>
                            <option value="5">5s</option>
                            <option value="10">10s</option>
                        </select>
                        <button id="refresh-now" class="btn-primary">Refresh now</button>
                    </div>
                    <p class="mt-4 text-sm text-gray-500">
                        When enabled the dashboard automatically updates device readings and generates alerts based on heuristics.
                    </p>
                </div>

                <!-- Add Demo Devices Card -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Add demo devices</h2>
                    <div class="space-y-4">
                        <select id="device-type" class="form-select block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="temperature">Temperature Sensor</option>
                            <option value="motion">Motion Sensor</option>
                            <option value="light">Light Sensor</option>
                            <option value="humidity">Humidity Sensor</option>
                        </select>
                        <input type="text" id="device-name" placeholder="Optional name" class="form-input block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                        <button id="add-device" class="btn-primary w-full">Add</button>
                        <button id="add-batch" class="btn-primary w-full bg-green-500 hover:bg-green-600">Add sample batch (5)</button>
                    </div>
                    <p class="mt-4 text-sm text-gray-500">
                        Devices are demo-only and use randomized readings. You can toggle their power and more.
                    </p>
                </div>
            </div>

            <!-- Right Column: Device Cards -->
            <div id="device-container" class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Device cards will be injected here by JavaScript -->
            </div>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const lastUpdateEl = document.getElementById('last-update');
            const summaryDevicesEl = document.getElementById('summary-devices');
            const summaryOnlineEl = document.getElementById('summary-online');
            const summaryOfflineEl = document.getElementById('summary-offline');
            const summaryAlertsEl = document.getElementById('summary-alerts');
            const refreshIntervalEl = document.getElementById('refresh-interval');
            const refreshNowBtn = document.getElementById('refresh-now');
            const deviceTypeEl = document.getElementById('device-type');
            const deviceNameEl = document.getElementById('device-name');
            const addDeviceBtn = document.getElementById('add-device');
            const addBatchBtn = document.getElementById('add-batch');
            const deviceContainerEl = document.getElementById('device-container');

            let devices = [];
            let autoRefreshInterval = null;

            // Utility functions
            function formatTime(date) {
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${hours}:${minutes} ${date.getHours() >= 12 ? 'PM' : 'AM'}`;
            }

            function updateLastUpdate() {
                lastUpdateEl.textContent = new Date().toLocaleString();
            }

            function generateDeviceId(type) {
                const prefix = 'dev-';
                return prefix + Math.random().toString(36).substring(2, 8);
            }

            function generateRandomReading(type) {
                switch (type) {
                    case 'temperature':
                        return { value: (Math.random() * 20 + 10).toFixed(1), unit: '°C' };
                    case 'humidity':
                        return { value: (Math.random() * 50 + 30).toFixed(0), unit: '%' };
                    case 'light':
                        return { value: (Math.random() * 100).toFixed(0), unit: '%' };
                    case 'motion':
                        return { value: (Math.random() > 0.5 ? 1 : 0), unit: 'events' };
                    default:
                        return { value: 'N/A', unit: '' };
                }
            }

            function generateRandomBattery() {
                return (Math.random() * 80 + 20).toFixed(0);
            }

            // Rendering functions
            function renderDevices() {
                deviceContainerEl.innerHTML = '';
                devices.forEach(device => {
                    const statusColor = device.online ? 'bg-green-500' : 'bg-red-500';
                    const statusText = device.online ? 'Online' : 'Offline';
                    const card = document.createElement('div');
                    card.className = 'card p-6 flex flex-col justify-between';
                    card.innerHTML = `
                        <div>
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-semibold text-gray-800">${device.name}</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2.5 h-2.5 rounded-full ${statusColor}"></div>
                                    <span class="text-sm text-gray-600">${statusText}</span>
                                    <span class="text-xs text-gray-400">${formatTime(new Date())}</span>
                                </div>
                            </div>
                            <p class="text-sm text-gray-500 font-mono">ID: ${device.id}</p>
                            
                            <div class="mt-4">
                                <p class="text-sm font-semibold text-gray-700">Readings</p>
                                <div class="mt-2 flex items-center justify-between">
                                    <p class="font-medium text-gray-600">${device.type === 'motion' ? 'Motion events' : device.type.charAt(0).toUpperCase() + device.type.slice(1)}</p>
                                    <p class="text-xl font-bold text-gray-800">${device.reading.value} <span class="text-sm font-normal text-gray-600">${device.reading.unit}</span></p>
                                </div>
                                <p class="text-sm font-semibold mt-4 text-gray-700">Battery</p>
                                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                                    <div class="bg-green-400 h-2.5 rounded-full" style="width: ${device.battery}%;"></div>
                                </div>
                                <p class="text-sm text-gray-500 text-right mt-1">${device.battery}%</p>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-600">Power: <span class="text-green-500">ON</span></p>
                            <div class="flex items-center space-x-2">
                                <button class="btn-primary bg-yellow-500 hover:bg-yellow-600 text-sm py-1.5 px-3 reboot-btn" data-id="${device.id}">Reboot</button>
                                <button class="btn-primary text-sm py-1.5 px-3">More</button>
                            </div>
                        </div>
                    `;
                    deviceContainerEl.appendChild(card);
                });
                attachRebootListeners();
                updateSummary();
            }

            function updateAllReadings() {
                devices.forEach(device => {
                    device.reading = generateRandomReading(device.type);
                    device.battery = generateRandomBattery();
                });
                renderDevices();
            }

            function updateSummary() {
                summaryDevicesEl.textContent = devices.length;
                summaryOnlineEl.textContent = devices.filter(d => d.online).length;
                summaryOfflineEl.textContent = devices.filter(d => !d.online).length;
                // No alerts logic for now
                summaryAlertsEl.textContent = 0;
            }

            function addDevice(type, name) {
                const newDevice = {
                    id: generateDeviceId(type),
                    name: name || (type.charAt(0).toUpperCase() + type.slice(1)) + ' Sensor',
                    type: type,
                    online: true,
                    reading: generateRandomReading(type),
                    battery: generateRandomBattery(),
                };
                devices.push(newDevice);
                renderDevices();
            }

            function attachRebootListeners() {
                document.querySelectorAll('.reboot-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const deviceId = e.target.dataset.id;
                        const device = devices.find(d => d.id === deviceId);
                        if (device) {
                            device.online = false;
                            renderDevices();
                            setTimeout(() => {
                                device.online = true;
                                device.reading = generateRandomReading(device.type);
                                renderDevices();
                            }, 3000); // Simulate a 3-second reboot
                        }
                    });
                });
            }
            
            // Event Listeners
            refreshNowBtn.addEventListener('click', () => {
                updateAllReadings();
            });

            refreshIntervalEl.addEventListener('change', (e) => {
                const interval = parseInt(e.target.value);
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                }
                if (interval > 0) {
                    autoRefreshInterval = setInterval(updateAllReadings, interval * 1000);
                }
            });

            addDeviceBtn.addEventListener('click', () => {
                const type = deviceTypeEl.value;
                const name = deviceNameEl.value;
                addDevice(type, name);
                deviceNameEl.value = '';
            });

            addBatchBtn.addEventListener('click', () => {
                for (let i = 0; i < 5; i++) {
                    const types = ['temperature', 'motion', 'light', 'humidity'];
                    const randomType = types[Math.floor(Math.random() * types.length)];
                    addDevice(randomType, '');
                }
            });

            // Initial setup
            function init() {
                updateLastUpdate();
                addDevice('temperature', 'Server Room T1');
                addDevice('temperature', 'Temperature 7lyd');
                addDevice('motion', 'Main Entrance Motion');
                addDevice('light', 'Hallway Light');
                addDevice('humidity', 'Humidity qzr0');
            }

            init();
        });
    </script>
</body>
</html>
